# Copyright (c) 2013 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

VALID_TOOLCHAINS := glibc
NACL_SDK_ROOT ?= $(abspath $(CURDIR)/../../..)
include $(NACL_SDK_ROOT)/tools/common.mk

TARGET = python
LIBS = python2.7 util dl ppapi_simple nacl_io ppapi_cpp ppapi
SOURCES = python.c
INC_PATHS = $(NACLPORTS_INCLUDE)/python2.7
INSTALL_DIR = $(NACL_PACKAGES_PUBLISH)/python

# Build rules generated by macros from common.mk:

$(foreach src,$(SOURCES),$(eval $(call COMPILE_RULE,$(src),$(CFLAGS))))

ifeq ($(CONFIG),Release)
$(eval $(call LINK_RULE,$(TARGET)_unstripped,$(SOURCES),$(LIBS),$(DEPS)))
$(eval $(call STRIP_RULE,$(TARGET),$(TARGET)_unstripped))
else
$(eval $(call LINK_RULE,$(TARGET),$(SOURCES),$(LIBS),$(DEPS)))
endif

$(eval $(call HTML_RULE,$(TARGET),))

install:
	mkdir -p $(INSTALL_DIR)
	cp $(OUTDIR)/python_*.nexe $(INSTALL_DIR)
	cp $(OUTDIR)/python.nmf $(INSTALL_DIR)
	cp $(OUTDIR)/python.html $(INSTALL_DIR)
	cp -r $(OUTDIR)/lib* $(INSTALL_DIR)
