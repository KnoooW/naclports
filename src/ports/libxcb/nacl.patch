diff --git a/configure b/configure
index 93e1a00..bbc78dd 100755
--- a/configure
+++ b/configure
@@ -13123,7 +13123,9 @@ else
 $as_echo "yes" >&6; }
 
 fi
-NEEDED="pthread-stubs xau >= 0.99.2"
+# Dropped pthread-stubs since for nacl we can always build against pthreads.
+# This avoids an unused package.
+NEEDED="xau >= 0.99.2"
 
 pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for NEEDED" >&5
diff --git a/src/xcb_conn.c b/src/xcb_conn.c
index 725502a..5e4b08b 100644
--- a/src/xcb_conn.c
+++ b/src/xcb_conn.c
@@ -179,7 +179,8 @@ static int write_vec(xcb_connection_t *c, struct iovec **vector, int *count)
     int n;
     assert(!c->out.queue_len);
 
-#ifdef _WIN32
+    /* Using writev emulation for nacl newlib. */
+#if defined(_WIN32) || (defined(__native_client__) && defined(_NEWLIB_VERSION))
     int i = 0;
     int ret = 0,err = 0;
     struct iovec *vec;
@@ -191,10 +192,17 @@ static int write_vec(xcb_connection_t *c, struct iovec **vector, int *count)
     while(i < *count)
     {         	 
          ret = send(c->fd,vec->iov_base,vec->iov_len,0);	 
+         /* Generalize to posix so this can be used with nacl newlib. */
+#if defined(__native_client__) && defined(_NEWLIB_VERSION)
+         if(ret < 0)
+         {
+             if(errno == EWOULDBLOCK)
+#else
          if(ret == SOCKET_ERROR)
          {
              err  = WSAGetLastError();
              if(err == WSAEWOULDBLOCK)
+#endif
              {
                  return 1;
              }
