diff --git a/Makefile.in b/Makefile.in
index 2ccaaf3..3a34445 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -18,7 +18,7 @@ APR_MAJOR_VERSION=@APR_MAJOR_VERSION@
 INCDIR=./include
 OSDIR=$(top_srcdir)/include/arch/@OSDIR@
 DEFOSDIR=$(INCDIR)/arch/@DEFAULT_OSDIR@
-INCLUDES=-I$(INCDIR) -I$(OSDIR) -I$(DEFOSDIR) -I$(top_srcdir)/include/arch/@DEFAULT_OSDIR@ -I$(top_srcdir)/include -I$(top_srcdir)/include/private
+INCLUDES=-I$(INCDIR) -I$(OSDIR) -I$(DEFOSDIR) -I$(top_srcdir)/include/arch/@DEFAULT_OSDIR@ -I$(top_srcdir)/include -I$(top_srcdir)/include/private -Iinclude/private
 
 #
 # Macros for target determination
@@ -134,7 +134,8 @@ tools/gen_test_char@EXEEXT@: $(OBJECTS_gen_test_char)
 	$(LINK_PROG) $(OBJECTS_gen_test_char) $(ALL_LIBS)
 
 include/private/apr_escape_test_char.h: tools/gen_test_char@EXEEXT@
-	tools/gen_test_char@EXEEXT@ > $@
+	mkdir -p include/private
+	$(RUNPROGRAM) tools/gen_test_char@EXEEXT@ > $@
 
 LINK_PROG = $(LIBTOOL) $(LTFLAGS) --mode=link $(COMPILE) $(LT_LDFLAGS) \
 	    @LT_NO_INSTALL@ $(ALL_LDFLAGS) -o $@
diff --git a/configure b/configure
index 0b5b83a..52be06b 100755
--- a/configure
+++ b/configure
@@ -11760,7 +11760,7 @@ irix5* | irix6* | nonstopux*)
   ;;
 
 # This must be glibc/ELF.
-linux* | k*bsd*-gnu | kopensolaris*-gnu)
+linux* | k*bsd*-gnu | kopensolaris*-gnu | nacl* | nacl*)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
@@ -16955,6 +16955,28 @@ uts4*)
   shlibpath_var=LD_LIBRARY_PATH
   ;;
 
+nacl)
+  if $CC -v 2>&1 | grep -q enable-shared; then
+    dynamic_linker="GNU/NaCl ld.so"
+    version_type=linux
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
+    soname_spec='${libname}${release}${shared_ext}$major'
+  else
+    dynamic_linker=no
+  fi
+  ;;
+
+nacl)
+  if $CC -v 2>&1 | grep -q enable-shared; then
+    dynamic_linker="GNU/NaCl ld.so"
+    version_type=linux
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
+    soname_spec='${libname}${release}${shared_ext}$major'
+  else
+    dynamic_linker=no
+  fi
+  ;;
+
 *)
   dynamic_linker=no
   ;;
@@ -20959,7 +20981,8 @@ if ${ac_cv_file__dev_zero+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   test "$cross_compiling" = yes &&
-  as_fn_error $? "cannot check for file existence when cross compiling" "$LINENO" 5
+  ac_cv_file__dev_zero=no
+  #as_fn_error $? "cannot check for file existence when cross compiling" "$LINENO" 5
 if test -r "/dev/zero"; then
   ac_cv_file__dev_zero=yes
 else
@@ -23051,7 +23074,8 @@ if ${ac_cv_func_setpgrp_void+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test "$cross_compiling" = yes; then :
-  as_fn_error $? "cannot check setpgrp when cross compiling" "$LINENO" 5
+  ac_cv_func_setpgrp_void=no
+  #as_fn_error $? "cannot check setpgrp when cross compiling" "$LINENO" 5
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
@@ -24262,7 +24286,7 @@ if ${ac_cv_sizeof_struct_iovec+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test "$cross_compiling" = yes; then :
-  ac_cv_sizeof_struct_iovec=0
+  ac_cv_sizeof_struct_iovec=8
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
@@ -27355,10 +27379,8 @@ if ${apr_cv_tcp_nodelay_with_cork+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test "$cross_compiling" = yes; then :
-  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error $? "cannot run test program while cross compiling
-See \`config.log' for more details" "$LINENO" 5; }
+  apr_cv_tcp_nodelay_with_cork=no
+  #{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;} as_fn_error $? "cannot run test program while cross compiling See \`config.log' for more details" "$LINENO" 5; }
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
diff --git a/include/apr.h.in b/include/apr.h.in
index 0ad7a91..c6372e6 100644
--- a/include/apr.h.in
+++ b/include/apr.h.in
@@ -189,6 +189,9 @@
 #endif
 
 /* header files for PATH_MAX, _POSIX_PATH_MAX */
+#if defined(__native_client__)
+#include <linux/limits.h>
+#endif
 #if APR_HAVE_LIMITS_H
 #include <limits.h>
 #else
